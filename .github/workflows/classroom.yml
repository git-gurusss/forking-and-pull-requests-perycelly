name: ğŸš€ Autograding Forking and Pull Requests

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  grade:
    runs-on: ubuntu-latest

    steps:
    # ğŸ” Step 1: Checkout the PR code
    - name: ğŸ“‚ Checkout Repository
      uses: actions/checkout@v3

    # ğŸ”§ Step 2: Install necessary tools
    - name: ğŸ› ï¸ Install jq (for JSON validation)
      run: sudo apt-get install -y jq

    # ğŸš¨ Step 3: Protect critical paths
    - name: ğŸ›¡ï¸ Check Protected Paths
      run: |
        echo "ğŸ”’ Validating changes to protected paths..."
        protected_paths=(".github/")
        for path in "${protected_paths[@]}"; do
          if git diff --name-only HEAD^ HEAD | grep -q "^$path"; then
            echo "âŒ Unauthorized change detected in $path!"
            exit 1
          fi
        done
        echo "âœ… No unauthorized changes detected in protected paths!"

    # âœ… Step 4: Validate the changes
    - name: ğŸ” Validate Changes
      run: |
        echo "ğŸ” Checking the contents of example.txt..."
        # Check if example.txt has been edited
        if ! grep -q "Student has made a change" example.txt; then
          echo "âŒ example.txt has not been edited correctly!"
          exit 1
        fi
        echo "âœ… example.txt has been edited as required!"

    # ğŸ‰ Step 5: Provide feedback
    - name: ğŸ† Complete Grading
      run: echo "âœ… Autograding complete! Well done! ğŸ‰"
